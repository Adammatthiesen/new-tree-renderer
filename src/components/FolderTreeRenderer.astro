---
import type { FolderNode } from "../types";
import FolderTreeNode from "./FolderTreeNode.astro";
import FolderTreeLeaf from "./FolderTreeLeaf.astro";

interface Props {
    data: FolderNode[];
    depth?: number;
}

const { data, depth = 0 } = Astro.props;

/**
 * Recursively sorts a tree of pages and folders by name (A to Z).
 * @param data - The array of folders and pages to sort.
 * @returns A new array with the sorted structure.
 */
function sortTree(data: FolderNode[]): FolderNode[] {
    return data
        .map((node) => ({
            ...node,
            children: sortTree(node.children),
        }))
        .sort((a, b) => a.name.localeCompare(b.name));
}

const sortedData = sortTree(data);
---

<div class="folder-tree-container">
    {
        sortedData.map((node) =>
            node.page ? (
                <FolderTreeLeaf node={node} depth={depth} />
            ) : (
                <FolderTreeNode node={node} depth={depth}>
                    {node.children && node.children.length > 0 && (
                        <Astro.self data={node.children} depth={depth + 1} />
                    )}
                </FolderTreeNode>
            ),
        )
    }
</div>

<style>
    .folder-tree-container {
        display: flex;
        flex-direction: column;
        gap: 0.125rem;
        width: 100%;
    }
</style>
